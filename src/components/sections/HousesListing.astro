---
import { Image } from 'astro:assets';
import FloorplanCard from './FloorplanCard.astro';
import { typologies, housesByType } from '~/data/houses';
---

<section id="viviendas" class="py-20 md:py-28 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <!-- Header -->
    <div class="text-center mb-16 scroll-animate">
      <p class="text-primary font-medium tracking-[0.15em] uppercase text-sm mb-4">Viviendas</p>
      <h2 class="font-serif text-3xl md:text-4xl lg:text-5xl text-default leading-tight mb-4">
        Dos tipologías, <br class="hidden md:block" />un mismo estándar de excelencia
      </h2>
      <p class="text-muted text-lg max-w-2xl mx-auto">
        Todas las viviendas cuentan con distintas terrazas que abren los espacios interiores, dotándolos de una gran luminosidad.
      </p>
    </div>

    <!-- Typology Blocks -->
    <div class="space-y-20">
      {typologies.map((typo) => {
        const floorplans = housesByType(typo.type);
        return (
          <div class="scroll-animate" data-delay="100">
            <!-- Typology Header with Background Image -->
            <div class="relative rounded-2xl overflow-hidden mb-8">
              <Image
                src={typo.image}
                alt={typo.imageAlt}
                class="w-full h-64 md:h-80 object-cover"
                widths={[640, 1024, 1600]}
                sizes="(max-width: 1280px) 100vw, 1280px"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
              <div class="absolute bottom-0 left-0 right-0 p-6 md:p-10">
                <p class="text-white/70 text-sm uppercase tracking-wider mb-1">{typo.subtitle}</p>
                <h3 class="font-serif text-2xl md:text-3xl text-white">{typo.title}</h3>
              </div>
            </div>

            <!-- Description -->
            <p class="text-muted leading-relaxed mb-8 text-justify">
              {typo.description}
            </p>

            <!-- Floorplan Cards -->
            <div class:list={[
              'grid gap-4',
              floorplans.length > 2 ? 'grid-cols-2 md:grid-cols-4' : 'grid-cols-2 md:grid-cols-2 max-w-lg',
            ]}>
              {floorplans.map((fp) => (
                <FloorplanCard
                  href={fp.floorplanPdf}
                  thumbnail={fp.thumbnail}
                  label={fp.label}
                  address={fp.address}
                  constructedArea={fp.constructedArea}
                  plotArea={fp.plotArea}
                  price={fp.price}
                  sold={fp.sold}
                />
              ))}
            </div>
          </div>
        );
      })}
    </div>
  </div>
</section>
